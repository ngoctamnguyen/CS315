<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Inventory</title>
        <link rel="stylesheet" href="invent.css">
    </head>
    <body>
    <div class="box">    
        <h3>Inventory</h3>
        <div class="inputbox">
            <p>Item Name:</p>
            <input name="inputName" type="text" id="name" />
            <p>Item Price</p>
            <input name="inputPrice" type="text" id="price" />
            <p>Quantity</p>
            <input name="inputQuantity" type="text" id="quantity" />
            <p>Rating</p>
            <input name="inputRating" type="text" id="rating" />  
        </div>
    </div>
    <br>
        <button name="addBtn" onclick="addRow()">Add</button>
        <button name="updateBtn" onclick="update()" disabled>Update</button>
        <select name="sortList" >
            <option value="" disabled selected>Filter By...</option>
            <option>Sort by Name</option>
            <option>Sort by Price</option>
        </select>  
        <select name="filterList">
            <option value="" disabled selected>Filter By...</option>
            <option>Quantity</option>
            <option>Rating</option>
        </select>
        <br><br>
        <!-- table -->
    <div class="boxtable">      
        <table id="myTable">
            <tr>
                <th>Product name</th>
                <th>Price</th>
                <th>Quanrity</th>
                <th>Rating</th>
                <th>Edit</th>
                <th>remove</th>
            </tr>
        </table>
    </div>
        <script>
            let rowUpdate = -1;
            function checkEmpty() {
                let boxes = document.getElementsByTagName("input");
                for (let box of boxes) {
                    if (box.value == "") {
                        alert("Check all boxes have to not empty!");
                        return true;
                    }
                }
                return false;
            }
            function addRow() {
                /*Check Empty*/
                if (checkEmpty()) {
                    return;
                };

                /*Check Price is number*/
                if (Number.isInteger(parseInt(document.getElementById("price").value)) == false) {
                    alert("Price must be a number");
                    let elePrice = document.getElementById("price");
                    elePrice.style.backgroundColor = "red";
                    elePrice.focus();
                    return;
                } else {
                    let elePrice = document.getElementById("price");
                    elePrice.style.backgroundColor = "white";   
                }
                let table = document.getElementById("myTable");
                let row = table.insertRow();
                let cell1 = row.insertCell(0);
                let cell2 = row.insertCell(1);
                let cell3 = row.insertCell(2);
                let cell4 = row.insertCell(3);
                let cell5 = row.insertCell(4);
                let cell6 = row.insertCell(5);
                cell1.innerHTML = document.getElementById("name").value;
                cell2.innerHTML = document.getElementById("price").value;
                cell3.innerHTML = document.getElementById("quantity").value;
                cell4.innerHTML = document.getElementById("rating").value; 
                cell5.innerHTML = "<input id='edit' type='button' onclick='edit(this)' value='edit'/>";
                cell6.innerHTML = "<input id='remove' type='button' onclick='remove(this)' value='remove'/>";
                /*Clear input box*/
                document.getElementById("name").value = "";
                document.getElementById("price").value = "";
                document.getElementById("quantity").value = "";
                document.getElementById("rating").value = "";
            }
            function remove(row) {
                row.parentNode.parentNode.remove();
                // let i = row.parentNode.parentNode.rowIndex;
                // document.getElementById("myTable").deleteRow(i);
            }
            function edit(rowNum) {
                let table = document.getElementById("myTable");
                let rows = table.rows;
                let i = rowNum.parentNode.parentNode.rowIndex;
                rowUpdate = i;
                document.getElementById("name").value = rows[i].getElementsByTagName("td")[0].innerHTML;
                document.getElementById("price").value = rows[i].getElementsByTagName("td")[1].innerHTML;
                document.getElementById("quantity").value = rows[i].getElementsByTagName("td")[2].innerHTML;
                document.getElementById("rating").value = rows[i].getElementsByTagName("td")[3].innerHTML;
                document.getElementsByName("updateBtn")[0].disabled = false;
                document.getElementsByName("addBtn")[0].disabled = true;
            }
            function update() {
                let table = document.getElementById("myTable");
                let rows = table.rows;
                if (rowUpdate >= 0 ) {
                    rows[rowUpdate].getElementsByTagName("td")[0].innerHTML = document.getElementById("name").value;
                    rows[rowUpdate].getElementsByTagName("td")[1].innerHTML = document.getElementById("price").value;
                    rows[rowUpdate].getElementsByTagName("td")[2].innerHTML = document.getElementById("quantity").value;
                    rows[rowUpdate].getElementsByTagName("td")[3].innerHTML = document.getElementById("rating").value;
                    rowUpdate = -1;
                    document.getElementById("name").value = "";
                    document.getElementById("price").value = "";
                    document.getElementById("quantity").value = "";
                    document.getElementById("rating").value = "";
                    document.getElementsByName("updateBtn")[0].disabled = true;
                    document.getElementsByName("addBtn")[0].disabled = false;
                }
            }
            function sortTable(column) {
                let col = column;
                let table, rows, switching, x, y;
                table = document.getElementById("myTable");
                switching = true;
                while (switching) {
                    switching = false;
                    rows = table.rows;
                    for (let i = 1; i < (rows.length - 1); i++) {
                        x = rows[i].getElementsByTagName("TD")[col];
                        y = rows[i + 1].getElementsByTagName("TD")[col];
                        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                            rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                            switching = true;
                            break;
                        }
                    }
                }
            }

            function filterFunction() {
                let input, filter, ul, li, a, i;
                input = document.getElementById("myInput");
                filter = input.value.toUpperCase();
                div = document.getElementById("myDropdown");
                a = div.getElementsByTagName("a");
                for (i = 0; i < a.length; i++) {
                    txtValue = a[i].textContent || a[i].innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    a[i].style.display = "";
                    } else {
                    a[i].style.display = "none";
                    }
                }
            }

            window.onload = function (){
                let selectElement = document.getElementsByName("sortList")[0];
                selectElement.onchange = sortSelection;
            }
    
            function sortSelection(){
                for(let option of this.options){    
                    if(option.selected){
                        if (option.innerHTML == "Sort by Name") {
                            sortTable(0);
                        } else {
                            if (option.innerHTML == "Sort by Price") {
                                sortTable(1);
                            }
                        }
                    }  
                }
            }            
        </script>
        <br>
        <!-- Validation -->
        <div>
            <a href="https://validator.w3.org/nu/?doc=<https://github.com/ngoctamnguyen/CS315/blob/main/inventoryEventDom.html>"
            style="background-color: transparent">
            <img style="border-style:none" width="88" height="31"
            src="http://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0 Strict" /></a>
            &nbsp;&nbsp;
            <a href="http://jigsaw.w3.org/css-validator/check/referer"
            style="background-color: transparent">
            <img style="border-style:none" width="88" height="31"
            src="http://jigsaw.w3.org/css-validator/images/vcss" alt="Valid CSS!" /></a>
        </div>
    </body>
</html>